# MetronomeMegaMax 完了タスクアーカイブ

このファイルには、progress.txt および manual-work.txt から完了したタスクを移動して記録します。

---

## 完了タスク一覧

### 2026-02-24 完了

#### manual-work.txt より

**1. Firebase 設定**

1.1 Firebase プロジェクト作成
- [x] Firebase Console でプロジェクト作成
- [x] プロジェクト名: metronome-mega-max
- [x] Google Analytics の有効化（任意）

1.2 Firebase Authentication 設定
- [x] Authentication を有効化
- [x] Google Sign-In プロバイダーを有効化
- [ ] 承認済みドメインの追加（本番ドメイン） → **本番リリース時に実施**

1.3 Firebase Firestore 設定
- [x] Firestore Database を作成
- [x] 本番モードで開始
- [x] セキュリティルールの設定（ユーザーごとのアクセス制御）

1.4 Firebase Storage 設定
- [x] Storage を有効化
- [x] セキュリティルールの設定（20MB制限、音声ファイルのみ許可）

1.5 Firebase 設定ファイル取得
- [x] iOS 用 GoogleService-Info.plist のダウンロード
- [x] Web 用 Firebase Config の取得
- [x] 設定ファイルをプロジェクトに配置（ios/config/）
- [x] .gitignore に追加

**2. Apple Developer / App Store Connect 設定**

2.1 Apple Developer Program
- [x] Apple Developer Program への登録（年間 $99）
- [x] App ID の作成（Bundle ID 登録済み）

2.2 App Store Connect
- [x] App Store Connect で新規 App を作成
- [x] App 情報の入力
  - App 名: MetronomeMegaMax
  - プライマリ言語: 日本語
  - カテゴリ: ミュージック

---

### 2026-02-27 完了

#### manual-work.txt より

**4. Google Cloud Platform OAuth設定**

4.1 OAuth 同意画面
- [x] OAuth 同意画面の設定
- [x] アプリ名: MetronomeMegaMax
- [x] ユーザーサポートメール設定
- [x] デベロッパー連絡先設定
- [x] User Type: 外部

4.2 OAuth クライアント ID
- [x] iOS 用 OAuth クライアント ID の作成
  - 名前: MetronomeMegaMax iOS
  - バンドルID: com.yourcompany.metronomemegamax
  - クライアントID: 974435441915-b6siss7gr20a2mcs54n7g6c73m39bjvr.apps.googleusercontent.com
- [x] Web 用 OAuth クライアント ID の作成
  - 名前: MetronomeMegaMax Web
  - 承認済みJavaScriptオリジン: http://localhost:19006, http://localhost:8081
  - クライアントID: 974435441915-c93e649pd68q5q6q1ch7ag6jt9egs6be.apps.googleusercontent.com

4.3 APIキー設定
- [x] Browser key に Identity Toolkit API を許可
- [x] .env ファイルにクライアントIDを設定
- [x] Google Sign-In 動作確認完了

**2.3 In-App Purchase 設定**

- [x] サブスクリプショングループの作成（Premium）
- [x] 月額プラン（200円）の作成
  - 参照名: Premium Monthly
  - 製品ID: premium_monthly_200
  - 期間: 1ヶ月
- [x] サンドボックステスターの追加（2名）
  - test@batsugaku.test
  - akairen0083@gmail.com

---

#### progress.txt より

**Phase 0: プロジェクトセットアップ** ✅ 完了（2026-02-24）

0.1 開発環境構築
- [x] Node.js / npm のバージョン確認（v24.9.0 / 11.6.0）
- [x] Expo CLI のインストール
- [x] Xcode のインストール・設定（Xcode 16.4）
- [x] iOS Simulator の設定

0.2 プロジェクト初期化
- [x] Expo プロジェクト作成（TypeScript テンプレート）
- [x] React Native for Web の設定
- [x] ESLint / Prettier の設定
- [x] Git リポジトリの初期化
- [x] .gitignore の設定
- [x] babel.config.js（パスエイリアス設定）
- [x] tsconfig.json（strict mode, パスエイリアス）

0.3 ディレクトリ構造の設計
- [x] src/ 以下のフォルダ構成を決定
- [x] components/, screens/, hooks/, utils/, services/ 等の作成
- [x] 多言語対応（i18n）のフォルダ構成

---

**Phase 1: 基盤実装** ✅ 完了（2026-02-24）

1.1 レイアウト基盤
- [x] レスポンシブレイアウトのブレークポイント定義（1440px, 1280px, 1120px）
- [x] メインレイアウトコンポーネント（Web横並び / スライダー切り替え）
- [x] ヘッダーコンポーネント（Web版）
- [x] ヘッダーコンポーネント（iOS版 / 1120px未満）
- [x] 広告配置用コンポーネント（プレースホルダー）

1.2 共通UIコンポーネント
- [x] パネルコンポーネント
- [x] メトロノームパネル（振り子アニメーション、ビートインジケーター）
- [x] タイマーパネル（時間表示、加算ボタン）
- [x] 音源再生パネル（シークバー、A-Bループ、速度制御）

1.3 多言語対応（i18n）
- [x] i18n 基盤実装（翻訳タイプ定義）
- [x] 日本語翻訳ファイル作成
- [x] 英語翻訳ファイル作成
- [x] スペイン語翻訳ファイル作成
- [x] useTranslation フック

---

### 2026-02-25 完了

#### progress.txt より

**Phase 2: メトロノーム機能** ✅ 完了（2026-02-25）

2.1 メトロノームUI
- [x] メトロノームパネルのレイアウト
- [x] BPM表示（大きな数字）
- [x] ±ボタンによるBPM調整
- [x] 振り子アニメーションの実装
- [x] ビートインジケーター（拍子に応じた丸印）の実装
- [x] 拍子セレクター（ドロップダウン）
- [x] アクセントセレクター（ドロップダウン）
- [x] START/STOPボタン

2.2 メトロノームオーディオエンジン（iOS）
- [x] Swift ネイティブモジュールの作成（modules/metronome-module/）
- [x] AVAudioEngine を使用したオーディオ再生
- [x] Look-ahead スケジューリングの実装（25ms間隔、100ms先読み）
- [x] BPM変更時のリアルタイム反映
- [x] 拍子変更時の対応
- [x] アクセントパターンの実装（3パターン）
- [x] React Native との Bridge 実装

2.3 メトロノームオーディオエンジン（Web）
- [x] Web Audio API を使用したオーディオ再生
- [x] AudioContext によるスケジューリング
- [x] Look-ahead パターンの実装
- [x] BPM/拍子/アクセントの対応

2.4 メトロノームクリック音
- [x] クリック音の音声ファイル準備（オシレーター合成で実装）
- [x] 音声ファイルのバンドル設定（assets/audioディレクトリ準備済）

---

**Phase 3: タイマー機能** ✅ 完了（2026-02-25）

3.1 タイマーUI
- [x] タイマーパネルのレイアウト
- [x] 時間表示（HH:MM:SS）
- [x] 加算ボタン群（30秒/1分/3分/5分/10分/30分）
- [x] 「時間を選択」ドロップダウン
- [x] START/一時停止ボタン
- [x] SAVEボタン

3.2 タイマーロジック
- [x] カウントダウンロジックの実装（useTimerフック）
- [x] 一時停止/再開機能
- [x] リセット機能
- [x] 終了時アラーム音の再生（Web Audio API）

---

**Phase 4: 音源再生機能** ✅ 完了（2026-02-25）

4.1 音源再生UI
- [x] 音源再生パネルのレイアウト
- [x] 15秒戻る/進むボタン
- [x] 再生/一時停止ボタン
- [x] シークバー
- [x] A-B区間設定入力欄
- [x] LOOPボタン
- [x] 再生速度セレクター
- [x] ファイル選択ボタン
- [x] アップロードボタン
- [x] SAVEボタン

4.2 音源再生ロジック（iOS）
- [x] AVAudioPlayer を使用した音源再生（modules/audio-player-module/）
- [x] シーク機能
- [x] 15秒スキップ機能
- [x] メトロノームとの同時再生対応（AVAudioSession mixWithOthers）

4.3 音源再生ロジック（Web）
- [x] HTML5 Audio による再生（useAudioPlayerフック）
- [x] シーク機能
- [x] 15秒スキップ機能

4.4 A-Bリピート機能（有料版）
- [x] A点/B点の設定ロジック
- [x] ループ再生の実装
- [x] LOOPボタンによるオン/オフ切り替え

4.5 再生速度変更（有料版）
- [x] 再生速度変更ロジック（0.5x〜2x）
- [x] ピッチ補正（preservesPitch）

4.6 ファイル選択
- [x] iOS: UIDocumentPickerViewController の実装
- [x] Web: input type="file" の実装
- [x] 対応フォーマット（mp3, wav）のフィルタリング
- [x] エラーハンドリング

---

**Phase 5: 認証・課金** ✅ 完了（2026-02-25）

5.1 Firebase Authentication
- [x] Firebase SDK の導入（firebase, expo-auth-session, expo-constants）
- [x] Firebase設定ファイル・初期化コード作成（src/services/firebase/）
- [x] Google Sign-In の実装（iOS / Web 両対応）
- [x] ログイン状態の管理（AuthContext）
- [x] ログインポップアップUI（LoginModal, UserMenu）

5.2 課金システム（iOS）
- [x] RevenueCat SDK の導入（react-native-purchases）
- [x] 購入フローの実装（src/services/payment/revenueCat.ts）
- [x] 購入状態の復元
- [x] 課金ポップアップUI（SubscriptionModal）
- [!] App Store Connect での In-App Purchase 設定（手動作業：manual-work.txt 2.3）

5.3 課金システム（Web）
- [x] Stripe SDK の導入（@stripe/stripe-js）
- [x] 課金ポップアップUI（SubscriptionModalに統合）
- [~] Stripe Checkout / Webhook（Backend連携が必要）

5.4 課金状態管理
- [x] SubscriptionContext の実装
- [x] Firestore での課金状態保存
- [x] プラットフォーム間での課金状態同期
- [x] 有料機能のアクセス制御実装

5.5 解約機能
- [x] iOS: App Store 経由の解約案内（設定画面リンク）
- [~] Web: Stripe Customer Portal（Backend連携が必要）

**作成ファイル:**
- src/services/firebase/config.ts
- src/services/firebase/auth.ts
- src/services/firebase/firestore.ts
- src/services/firebase/index.ts
- src/services/payment/revenueCat.ts
- src/services/payment/stripe.ts
- src/services/payment/index.ts
- src/contexts/AuthContext.tsx
- src/contexts/SubscriptionContext.tsx
- src/contexts/index.ts
- src/hooks/useGoogleAuth.ts
- src/components/auth/LoginModal.tsx
- src/components/auth/UserMenu.tsx
- src/components/auth/index.ts
- src/components/subscription/SubscriptionModal.tsx
- src/components/subscription/index.ts
- app.config.js（環境変数対応）

---

**Phase 6: プリセット・クラウド同期** ✅ 完了（2026-02-25）

6.1 Firestore データ設計
- [x] ユーザーデータのコレクション設計（users）
- [x] BPMプリセットのスキーマ設計（bpmPresets）
- [x] タイマープリセットのスキーマ設計（timerPresets）
- [x] ループポイントのスキーマ設計（loopPoints）

6.2 BPMプリセット保存（有料版）
- [x] プリセット保存ロジック（saveBpmPreset）
- [x] プリセット読み込みロジック（getBpmPresets）
- [x] プリセット削除ロジック（deleteBpmPreset）
- [x] useBpmPresets フック

6.3 タイマープリセット保存（有料版）
- [x] プリセット保存ロジック（saveTimerPreset）
- [x] プリセット読み込みロジック（getTimerPresets）
- [x] useTimerPresets フック

6.4 ループポイント保存（有料版）
- [x] Firebase Storage への音源アップロード（uploadAudioFile）
- [x] アップロード進捗表示
- [x] ファイルサイズ検証（20MB制限）
- [x] Firestore へのメタデータ保存（saveLoopPoint）
- [x] ループポイント読み込み・キャッシュ

**作成ファイル:**
- src/services/presets/bpmPresets.ts
- src/services/presets/timerPresets.ts
- src/services/presets/loopPoints.ts
- src/services/presets/index.ts
- src/hooks/usePresets.ts

---

**Phase 7: 広告** ✅ 完了（2026-02-25）

7.1 iOS広告（AdMob）
- [x] 広告コンポーネントの作成（AdBanner）
- [x] バナー広告の実装（下部）
- [x] 有料版での広告非表示
- [!] AdMob SDK の導入・設定（手動作業：manual-work.txt 5.1）

7.2 Web広告（AdSense）
- [x] 広告コンポーネントの作成
- [x] サイドバー広告（160x600）の実装
- [x] 下部広告（728x90）の実装
- [x] レスポンシブ対応
- [x] 有料版での広告非表示
- [!] AdSense コードの設置（手動作業：manual-work.txt 5.2）

**作成ファイル:**
- src/components/ads/AdBanner.tsx
- src/components/ads/index.ts

---

**Phase 8: バックグラウンド再生（iOS有料版）** ✅ 完了（2026-02-25）

8.1 バックグラウンド対応
- [x] Info.plist での Background Modes 設定（app.json: UIBackgroundModes: ["audio"]）
- [x] AVAudioSession の設定（.playback）（MetronomeModule.swiftで実装済み）

---

### 2026-02-27 完了（法務）

#### manual-work.txt より

**7. 法務・コンプライアンス** ✅ 完了（2026-02-27）

7.1 プライバシーポリシー
- [x] プライバシーポリシーの作成
  - 収集するデータ: メールアドレス、課金情報、利用データ、音声ファイル
  - 使用目的: 認証、課金管理、サービス提供、クラウド同期
  - 第三者提供: Firebase, Stripe, Apple, AdMob/AdSense
- [x] Webページとして公開
  - URL: https://metronome-mega-max.web.app/legal/privacy-policy.html

7.2 利用規約
- [x] 利用規約の作成
  - サービス内容（メトロノーム、タイマー、音源再生）
  - 有料プラン（月額200円）
  - 禁止事項
  - 免責事項
  - 知的財産権
  - 準拠法・管轄裁判所（日本法、東京地方裁判所）
- [x] Webページとして公開
  - URL: https://metronome-mega-max.web.app/legal/terms-of-service.html

7.3 特定商取引法に基づく表記
- [x] 販売事業者名
- [x] 所在地・連絡先
- [x] 販売価格（月額200円）
- [x] 支払方法（iOS: App Store、Web: Stripe）
- [x] 返品・キャンセルについて
- [x] 免責事項
- [x] Webページとして公開
  - URL: https://metronome-mega-max.web.app/legal/tokutei.html

**作成ファイル:**
- public/legal/privacy-policy.html
- public/legal/terms-of-service.html
- public/legal/tokutei.html

---

## アーカイブ履歴

| 日付 | 移動元 | タスク概要 |
|------|--------|-----------|
| 2026-02-24 | manual-work.txt | Firebase プロジェクト作成、Authentication設定 |
| 2026-02-24 | manual-work.txt | Firebase Firestore/Storage設定、設定ファイル取得 |
| 2026-02-24 | manual-work.txt | Apple Developer Program登録、App Store Connect設定 |
| 2026-02-24 | progress.txt | Phase 0: プロジェクトセットアップ完了 |
| 2026-02-24 | progress.txt | Phase 1: 基盤実装完了 |
| 2026-02-25 | progress.txt | Phase 2: メトロノーム機能完了 |
| 2026-02-25 | progress.txt | Phase 3: タイマー機能完了 |
| 2026-02-25 | progress.txt | Phase 4: 音源再生機能完了 |
| 2026-02-25 | progress.txt | Phase 5: 認証・課金完了 |
| 2026-02-25 | progress.txt | Phase 6: プリセット・クラウド同期完了 |
| 2026-02-25 | progress.txt | Phase 7: 広告完了 |
| 2026-02-25 | progress.txt | Phase 8: バックグラウンド再生完了 |
| 2026-02-27 | manual-work.txt | GCP OAuth設定完了（Google Sign-In動作確認済み） |
| 2026-02-27 | manual-work.txt | In-App Purchase設定完了（サブスクリプション・テスター追加） |
| 2026-02-27 | manual-work.txt | プロビジョニングプロファイル（開発用）完了 |
| 2026-02-27 | manual-work.txt | AdMob設定完了（バナー広告ユニット作成） |
| 2026-02-27 | manual-work.txt | Firebase Hosting設定・デプロイ完了 |
| 2026-02-27 | manual-work.txt | AdSenseサイト登録完了（審査待ち） |
| 2026-02-27 | manual-work.txt | Phase 6 ドメイン・ホスティング設定完了 |
| 2026-02-27 | manual-work.txt | セクション7 法務・コンプライアンス完了 |
| 2026-02-27 | manual-work.txt | セクション8.1 テストアカウント完了 |
| 2026-02-27 | manual-work.txt | セクション10.2 サポート体制完了 |
| 2026-02-27 | manual-work.txt | セクション8.2 テスト環境分離（不要と判断）完了 |
| 2026-02-27 | manual-work.txt | セクション10.1 Google Search Console設定完了 |
| 2026-02-27 | manual-work.txt | セクション10.1 Firebase Analytics確認（有効化済み）完了 |
| 2026-02-27 | manual-work.txt | セクション10.1 Firebase Crashlytics スキップ |
| 2026-02-27 | manual-work.txt | セクション10 リリース後設定 完了 |
